---
tag: å‰ç«¯
---

# Roadhog è¸©å‘è®°å½•



ç”¨ [roadhog](https://github.com/sorrycc/roadhog) æœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œå…¶ä¸­æ‰è¸©è¿‡å¤§å¤§å°å°è®¸å¤šå‘ï¼Œåˆå› ä¸ºå…¶ç‰ˆæœ¬æ›´æ–°è¯´æ˜åŸºæœ¬éƒ½ç¢ç‰‡å¼åœ°æ”¾åœ¨releasesé‡Œæˆ–è€…å¶å°”å‡ºç°åœ¨issuesé‡ŒğŸ˜ ï¼Œæ‰€ä»¥å†³å®šå¼€ä¸ªå‘è®°å½•ä¸€ä¸‹ã€‚



## Sass



ä» `1.0.0` å¼€å§‹å®Œæ•´åœ°æ”¯æŒäº† sass ï¼Œéœ€è‡ªè¡Œå¼•å…¥ sass-loader å’Œ node-sass ä¾èµ–ï¼Œæ–‡æ¡£æ²¡æœ‰å†™çš„åœ°æ–¹æ˜¯ sass çš„ webpack é…ç½®å¯ä»¥ç›´æ¥å†™åœ¨roadhogrcé‡Œï¼ŒsourceMap å’Œ includePaths å‡å¯ç”¨ï¼š



```js
export default {
  sass: {
    sourceMap: process.env.NODE_ENV === 'development',
    includePaths: [
      'node_modules',
      'src/style'
    ]
  },
  ...
}
```



> è®¾ç½® `includePaths` åä½¿ç”¨ `@import` æ—¶æ— éœ€å¤„ç†è·¯å¾„, è®¾ç½®ä¸­è·¯å¾„ä¸‹çš„æ–‡ä»¶å¯ä»¥ç›´æ¥å¼•å…¥ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒåŠ å…¥å½“å‰ç›®å½•ä¸­æœ‰åŒåçš„æ–‡ä»¶ï¼Œé‚£å½“å‰ç›®å½•ä¸­çš„ä¼˜å…ˆçº§å°†ä¼šæ¯” includePaths ä¸­çš„é«˜ã€‚



## Vendor



Vendorå¯ä»¥è§£å†³webpackæ‰“åŒ…ä½“ç§¯è¿‡å¤§çš„é—®é¢˜ï¼Œæå–ä¸å˜çš„ç¬¬ä¸‰æ–¹åº“å•ç‹¬æ‰“åŒ…å¼•å…¥ï¼Œé¿å…æ¯æ¬¡æ‰“åŒ…é‡å¤ä¸‹è½½ã€‚è¦å¼€å¯æ­¤åŠŸèƒ½é¦–å…ˆåˆ›å»º `src/vendor.js` æ–‡ä»¶ï¼š



```js
import 'react'
import 'react-dom'
import 'dva'
import 'dva-loading'
import 'history'

// å¦‚æœè¦åŠ¨æ€å¼•å…¥antdè¿™ä¹ˆå†™

import antd from 'antd'
const {Icon, Layout, Button, Popover, Collapse, BackTop, message} = antd
```



ç„¶ååœ¨ .roadhogrc.js é‡Œåšå¦‚ä¸‹é…ç½®



```js
export default {
  entry: {
    'index' : './src/index.js',
    'common': './src/vendor.js'
  },
  multipage: true,
  ...
}
```



## Hash



è¦å¼€å¯hashå¿…é¡»å¼€å¯ ejs (HtmlWebpackPlugin) åŠŸèƒ½ï¼Œå­˜åœ¨ `src/index.ejs` å³å¼€å¯æ­¤åŠŸèƒ½ï¼Œç„¶ååœ¨ .roadhogrc.js ä¸­åŠ å…¥ `hash: true` å³å¯ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å¼€å¯ ejs åï¼š



- åŸæœ‰çš„ index.html å°†å¤±æ•ˆï¼Œå‡å¯åˆ é™¤ï¼Œå¯ç›´æ¥å¤åˆ¶åˆ° index.ejs ä¸­ã€‚
- åœ¨ index.js ä¸­æ— éœ€å¼•å…¥ html.ejs æ–‡ä»¶
- æ— éœ€æ‰‹åŠ¨å¼•å…¥`index.js` `index.scss` `common.scss` ç­‰æ–‡ä»¶



## Roadhog.dll



å¼€å¯dllèƒ½å¾ˆå¤§ç¨‹åº¦æé«˜å¯åŠ¨å’Œç¼–è¯‘é¡¹ç›®çš„æ—¶é—´ï¼Œçº¦3å€å·¦å³ï¼Œè¦å¼€å¯dllæ”¯æŒéœ€è¦åšå¦‚ä¸‹é…ç½®ï¼š



**.roadhogrc.js **ï¼š

```js
export default {
  dllPlugin: {
    exclude: [
      'babel-runtime'
    ],
    include: [
      'dva/router',
      'dva/saga',
      'dva/fetch'
    ]
  },
  ...
}
```



**src/index.ejs**

```ejs
<body>
  <div id="root"></div>
  <% if (process.env.NODE_ENV === 'development') { %>
  <script type="text/javascript" src="/roadhog.dll.js"></script>
  <% } %>
</body>
```



**package.json**

```json
{
  "scripts": {
    "build": "roadhog build",
    "build:dll": "roadhog buildDll"
  }
}
```



å¼€å¯dllçš„åŠŸèƒ½è¯ï¼Œéœ€è¦ä¿è¯ dependencies é‡Œçš„åŒ…å’Œ vendor é‡Œçš„ä¸€è‡´ï¼Œå…¶ä»–æ”¾åœ¨ dev é‡Œï¼Œæˆ–è€…ç”¨ exclude è¿›è¡Œæ’é™¤ï¼Œå¦åˆ™å°†å‡ºç°è¯¸å¦‚æ‰¾ä¸åˆ°fsä¹‹ç±»æŠ¥é”™ï¼Œæ¯æ¬¡å¢åŠ æ–°åŒ…éƒ½éœ€è¦é‡æ–°æ‰§è¡Œ `yarn build:dll`ã€‚



## sw-precache



å¼€å¯æ¸è¿›å¼ç¼“å­˜æé«˜ç½‘ç«™åŠ è½½é€Ÿåº¦ï¼Œé¦–é€‰æ·»åŠ  `sw-precache` åŒ…ï¼Œåœ¨ package.json ä¸­ä¿®æ”¹ï¼š



```json
{
  "scripts": {
    "build": "roadhog build ; sw-precache --config=sw-precache-config.js",
    "build:dll": "roadhog buildDll"
  }
}
```



åœ¨æ ¹ç›®å½•åˆ›å»º sw-precache-config.js æ–‡ä»¶ï¼š



```js
module.exports = {
  stripPrefix: 'dist/',
  staticFileGlobs: [
    'dist/img/**/*',
    'dist/favicon/*',
    'dist/font/*',
    'dist/*common*'
  ],
  dontCacheBustUrlsMatching: /./,
  swFilePath: 'dist/sw-precache.js'
}
```



ä¿®æ”¹ html.ejsï¼š



```ejs
<head>
  ...
  <% if (process.env.NODE_ENV !== 'development') { %>
  <!--progressive-web-app-->
  <script type="text/javascript" src="/sw-precache.js"></script>
  <% } %>
</head>
```



