{"tag":["sketch","plugin"],"filename":"20180308185546_sketchplugin","body":"\n\n\n![full](http://qn.canisminor.cc/2018-03-08-085642.png)\n\næ‹¿ Sketch 49 çš„æ–° [JS API](http://developer.sketchapp.com/reference/api/) é‡æ„äº†ä¸€è¾¹ [SketchSelect](https://github.com/canisminor1990/sketch-select) æ’ä»¶ï¼Œæ„Ÿå—ï¼šSketch JS API æ–‡æ¡£æ¯”ä¹‹å‰æ¸…æ™°å¤ªå¤šï¼Œè¿˜å¸¦äº†ç¤ºä¾‹ä»£ç ç‰‡æ®µï¼Œå®˜æ–¹ç»ˆäºæƒ³èµ·æœ‰è¿™ä¹ˆä¸ªæ–‡æ¡£äº† ğŸ¤­ï¼Œä½†ç›®å‰æš´éœ²çš„å±æ€§éå¸¸ä¸å…¨ï¼Œåªèƒ½è¯´æ˜¯é˜‰å‰²ç‰ˆï¼Œæ¯”å¦‚ TextLayer çš„å­—ä½“ï¼ŒShapeLayer çš„æ··åˆæ¨¡å¼æŠ•å½±ç­‰ï¼Œè¿˜æœ‰è¯¸å¦‚å¯¼å‡ºï¼Œé”å®šï¼Œéšè—ç­‰çŠ¶æ€éƒ½æ— æ³•ç›´æ¥å–åˆ°ï¼Œè¿˜æ˜¯å¾—ç”¨å…¶ä¸‘æ— æ¯”çš„ CocoaScript æ–¹æ³•ã€‚\n\né™¤äº†æ¢ APIï¼ŒWebview æ–¹é¢ä¹Ÿé‡æ„äº†ä¸€éï¼Œskpm æä¾›äº†ä½¿ç”¨ webpack çš„[å®˜æ–¹ç¤ºä¾‹æ–‡ä»¶](https://github.com/skpm/with-webview/tree/master/template)ï¼Œè¿™è¾¹æˆ‘å› ä¸ºä½¿ç”¨ roadhog/dva å…¨å®¶æ¡¶ï¼Œæ‰€ä»¥é­”æ”¹äº†ä¸€éã€‚\n\n## å®‰è£…\n\n* [skpm](https://github.com/skpm/skpm): æ˜¯ sketch ç¬¬ä¸‰æ–¹å¼€å‘å·¥å…·é›†ï¼Œæä¾›è°ƒè¯•/æ‰“åŒ…/å‘å¸ƒç­‰å¼€å‘æ’ä»¶å¸¸ç”¨çš„åŠŸèƒ½ã€‚\n* @skpm/builder: skpm å¼€å‘åŒ…\n* [sketch-module-web-view](https://github.com/skpm/sketch-module-web-view): skpm æä¾›çš„ webview åŒ…\n* [roadhog](https://github.com/sorrycc/roadhog) / [dva](https://github.com/dvajs/dva): é˜¿é‡Œ react/redux/webpack å…¨å®¶æ¡¶\n* cross-env: è®¾ç½®ç¯å¢ƒå˜é‡\n* concurrently: è¿›ç¨‹å¤šå¼€\n\n```bash\n# å…¨å±€å®‰è£…skpmåŒ…\n$ npm i -g skpm\n# å®‰è£…ä¾èµ–\n$ yarn add @skpm/builder sketch-module-web-view dva\n$ yarn add roadhog cross-env concurrently --dev\n```\n\n### package é…ç½®\n\n* package.json\n\n```json\n{\n  \"engines\": {\n    \"sketch\": \">=49.0\"\n  },\n  \"skpm\": {\n    \"name\": \"plugin-name\",\n    \"manifest\": \"src/manifest.json\",\n    \"main\": \"plugin.sketchplugin\",\n    \"assets\": [\"dist\"]\n  },\n  \"scripts\": {\n    \"start\": \"concurrently \\\"yarn start:panel\\\" \\\"yarn start:plugin\\\"\",\n    \"start:plugin\": \"cross-env NODE_ENV=development skpm-build --watch\",\n    \"start:panel\": \"roadhog dev\",\n    \"build\": \"yarn build:panel && yarn build:plugin\",\n    \"build:plugin\": \"cross-env NODE_ENV=production skpm-build\",\n    \"build:panel\": \"roadhog build\",\n    \"publish\": \"skpm publish\",\n    \"link\": \"skpm-link\"\n  }\n}\n```\n\n### skpm é…ç½®\n\n* nameï¼šæ’ä»¶åç§°\n* manifestï¼šæ’ä»¶é…ç½®æ–‡ä»¶ `manifest.json` çš„ä½ç½®\n* main: æ‰“åŒ…åè¾“å‡ºçš„æ’ä»¶æ–‡ä»¶\n* assets(æ•°ç»„): èµ„æºæ–‡ä»¶ï¼ŒåŒ webpack ä¸­çš„ public\n\n> âš ï¸ è¿™é‡ŒæŠŠ webview ç¼–è¯‘åçš„ dist å½“åšèµ„æºæ–‡ä»¶ï¼Œç¼–è¯‘æ’ä»¶æ—¶ä¼šè‡ªåŠ¨å¤åˆ¶è¿‡å»ã€‚\n\n### roadhog é…ç½®\n\n* .webpackrc.js\n\n```js\nexport default {\n\tentry             : './panel/index.js',\n\tignoreMomentLocale: true,            : {\n\thtml              : {\n\t\t'template': './panel/index.ejs'\n\t},\n\tdefine            : {\n\t\t'$dirname': __dirname,\n\t\t'$isDev'  : process.env.NODE_ENV === 'development'\n\t},\n};\n```\n\nğŸ“˜ [roadhog å®˜æ–¹æ–‡æ¡£](https://github.com/sorrycc/roadhog)\n\n### æ–‡ä»¶ç»“æ„ï¼š\n\n```bash\n+ public              # webviewèµ„æºæ–‡ä»¶(æ’ä»¶ä½¿ç”¨çš„ä¹Ÿä¸€å¹¶æ”¾å…¥)\n\t- icon/png\n\t...\n\n+ panel               # webviewç›®å½•\n\t+ components\n\t+ models\n\t+ routes\n\t- index.js\n\t- index.ejs\n\t...\n+ src                 # æ’ä»¶ç›®å½•\n\t- manifest.json   # æ’ä»¶é…ç½®æ–‡ä»¶\n\t- index.js\n\t...\n- .webpackrc.js       # roadhogé…ç½®æ–‡ä»¶ï¼Œç”¨äºwebview\n- .appcast.xml        # sketchæ’ä»¶è‡ªåŠ¨æ›´æ–°ä¿¡æ¯\n- package.json\n\n# ç¼–è¯‘å\n\n+ dist                # 1.webview build\n\t- index.html\n\t- index.js\n\t- index.css\n\t- icon/png\n\t...\n+ plugin.sketchplugin # 2.plugin build\n\t+ Contents\n\t\t+ Resources   # webview/èµ„æºæ–‡ä»¶\n\t\t\t- index.html\n\t\t\t- index.js\n\t\t\t- index.css\n\t\t\t- icon/png\n\t\t\t...\n\t\t+ Sketch      # æ’ä»¶éƒ¨åˆ†\n\t\t\t- manifest.json\n\t\t\t- index.js\n\t\t\t- ...\n```\n\n## ä½¿ç”¨\n\n```bash\n# å¼€å‘ NODE_ENV=development\n# åŒæ—¶å¯åŠ¨å¹¶ç›‘å¬ plugin å’Œ webview\n# å¦‚æœä¸æƒ³æ¯æ¬¡è‡ªåŠ¨æ‰§è¡Œæ’ä»¶, å¯æŠŠ--runå»é™¤\n$ yarn start\n\n# æ‰“åŒ… NODE_ENV=development\n$ yarn build\n```\n\n### åˆ›å»º Panel\n\n* src/index.js\n\n```js\nimport WebUI from 'sketch-module-web-view';\n\n// åˆ¤æ–­æ˜¯å¦æ˜¯å¼€å‘ç¯å¢ƒ\nconst isDev = process.env.NODE_ENV === 'development';\n// å¼€å‘ç¯å¢ƒä¸­ä½¿ç”¨æµè§ˆå™¨è°ƒè¯•åœ°å€\nconst Panel = isDev ? 'http://localhost:8000' : 'index.html';\n\nexport default context => {\n  // åˆ›å»ºWebview Panel\n  const panelUI = new WebUI(context, Panel, {\n    identifier: 'plugin.panel', // çª—å£id\n    x: 0,\n    y: 0,\n    width: 340,\n    height: 624,\n    title: 'Sketch Select',\n    onlyShowCloseButton: true,\n    hideTitleBar: false,\n    shouldKeepAround: true,\n    resizable: false,\n    handlers: {\n      // plugin å’Œ webview ä¹‹é—´çš„é€šè®¯æ–¹æ³•\n    },\n  });\n};\n```\n\n> ğŸ“˜ [sketch-module-web-view å®˜æ–¹æ–‡æ¡£](https://github.com/skpm/sketch-module-web-view)\n\n### é€šè®¯æ–¹æ³•\n\n* src/index.js\n\n```js\npanelUI.handlers = {\n  // webview è¿œç¨‹è°ƒç”¨ plugin çš„æ–¹æ³•\n  onClick(callback) {\n    console.log(callback);\n\n    // plugin è¿œç¨‹è°ƒç”¨ webview ä¸­çš„æ–¹æ³•\n    const data = JSON.stringify({ ...Data });\n    panelUI.eval(`remoteFunc(${data})`);\n  },\n};\n```\n\n* panel/index.js\n\n```js\nimport pluginCall from 'sketch-module-web-view/client';\n\n// webview è¿œç¨‹è°ƒç”¨ plugin ä¸­çš„æ–¹æ³•\npluginCall('onClick', callback);\n\n// plugin è¿œç¨‹è°ƒç”¨ webview çš„æ–¹æ³•\nwindow.remoteFunc = data => {\n  const Data = JSON.parse(data);\n  console.log(Data);\n};\n```\n\n## è°ƒè¯•\n\n![nozoom](https://user-images.githubusercontent.com/3254314/32320758-1dc414d8-bfbf-11e7-9282-1d57fc53874d.png)\n\n* å®‰è£… [**sketch-dev-tools**](https://github.com/skpm/sketch-dev-tools)\n\n![full](http://qn.canisminor.cc/2018-03-08-dev-1.png)\n\n![full](http://qn.canisminor.cc/2018-03-08-dev-2.png)\n\nsketch-dev-tool å¯ä»¥åœ¨ sketch ä¸­å¼€å¯ç±»ä¼¼ Chrome å¼€å‘è€…å·¥å…·çš„é¢æ¿ï¼Œæ–¹ä¾¿è°ƒè¯•ï¼Œè¿˜å¯ä»¥ç›´æ¥æŸ¥é˜…å½“å‰ sketch æ–‡ä»¶çš„å›¾å±‚æ•°æ®ç»“æ„ï¼Œæ€»ä¹‹éå¸¸æ–¹ä¾¿ã€‚å¦‚æœæƒ³åœ¨ sketch ä¸­è°ƒè¯• webviewï¼Œå¯ä»¥åœ¨ webview ä¸­å†™ä¸€ä¸ª console æ–¹æ³•ï¼ŒæŠŠéœ€è¦æ‰“å°çš„å†…å®¹ä¼ ç»™ plugin è¿›è¡Œ debugã€‚\n\n# å‘å¸ƒ\n\n* æ‰“å¼€ GitHub â†’ Setting â†’ Developer settings\n* åœ¨ [Personal access tokens](https://github.com/settings/tokens) ä¸­ç”Ÿæˆä¸€ä¸ª token\n* éœ€è¦æœ‰æ“ä½œ repo æƒé™\n* ä½¿ç”¨ skpm è¿›è¡Œç™»å½• (åªéœ€ä¸€æ¬¡)\n\n```bash\n$ skpm login <github-token>\n```\n\n* å‘å¸ƒç‰ˆæœ¬\n\n```bash\n$ skpm publish <new-version>\n```\n\nå‘å¸ƒå‘½ä»¤ä¼šæ‰§è¡Œä¸‹æ“ä½œ:\n\n* ä¿®æ”¹ `package.json` ç‰ˆæœ¬å·\n* git tag å½“å‰ç‰ˆæœ¬\n* æŠŠ `plugin.sketchplugin` æ–‡ä»¶å‹ç¼©ä¸Šä¼ è‡³ github releases ä¸­\n* æ›´æ–° `.appcast.xml` æ–‡ä»¶, é€šçŸ¥ sketch æ›´æ–°æ­¤æ’ä»¶\n","title":"Sketch æ’ä»¶å¼€å‘ - skpm & webview"}